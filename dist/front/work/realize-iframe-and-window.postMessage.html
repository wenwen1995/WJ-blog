<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WJ-blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/WJ-blog/logo.jpg">
    <meta name="description" content="我的个人网站">
    <meta name="referrer" content="never">
    
    <link rel="preload" href="/WJ-blog/assets/css/0.styles.ac442f4a.css" as="style"><link rel="preload" href="/WJ-blog/assets/js/app.9890bca3.js" as="script"><link rel="preload" href="/WJ-blog/assets/js/2.38039cab.js" as="script"><link rel="preload" href="/WJ-blog/assets/js/32.7c28f772.js" as="script"><link rel="preload" href="/WJ-blog/assets/js/19.c27f844c.js" as="script"><link rel="prefetch" href="/WJ-blog/assets/js/10.4aa4f924.js"><link rel="prefetch" href="/WJ-blog/assets/js/11.2a0d3812.js"><link rel="prefetch" href="/WJ-blog/assets/js/12.a4f6b512.js"><link rel="prefetch" href="/WJ-blog/assets/js/13.e7abe64a.js"><link rel="prefetch" href="/WJ-blog/assets/js/14.be8cc402.js"><link rel="prefetch" href="/WJ-blog/assets/js/15.80e115f3.js"><link rel="prefetch" href="/WJ-blog/assets/js/16.2cb738bc.js"><link rel="prefetch" href="/WJ-blog/assets/js/17.279ae8d7.js"><link rel="prefetch" href="/WJ-blog/assets/js/18.982ea5c8.js"><link rel="prefetch" href="/WJ-blog/assets/js/20.ba677fba.js"><link rel="prefetch" href="/WJ-blog/assets/js/21.2a0d7643.js"><link rel="prefetch" href="/WJ-blog/assets/js/22.a5344bca.js"><link rel="prefetch" href="/WJ-blog/assets/js/23.4b8274ea.js"><link rel="prefetch" href="/WJ-blog/assets/js/24.42ac8861.js"><link rel="prefetch" href="/WJ-blog/assets/js/25.2690aeeb.js"><link rel="prefetch" href="/WJ-blog/assets/js/26.5a438088.js"><link rel="prefetch" href="/WJ-blog/assets/js/27.600f7bbe.js"><link rel="prefetch" href="/WJ-blog/assets/js/28.e592b7b8.js"><link rel="prefetch" href="/WJ-blog/assets/js/29.211c62f0.js"><link rel="prefetch" href="/WJ-blog/assets/js/3.9da2f380.js"><link rel="prefetch" href="/WJ-blog/assets/js/30.547715e6.js"><link rel="prefetch" href="/WJ-blog/assets/js/31.a4ac843a.js"><link rel="prefetch" href="/WJ-blog/assets/js/33.6f782f45.js"><link rel="prefetch" href="/WJ-blog/assets/js/34.72d267f0.js"><link rel="prefetch" href="/WJ-blog/assets/js/35.17fd4018.js"><link rel="prefetch" href="/WJ-blog/assets/js/36.6c0a59d6.js"><link rel="prefetch" href="/WJ-blog/assets/js/4.9a29327f.js"><link rel="prefetch" href="/WJ-blog/assets/js/5.f09a7e4f.js"><link rel="prefetch" href="/WJ-blog/assets/js/6.6cce9e14.js"><link rel="prefetch" href="/WJ-blog/assets/js/7.dce9316e.js"><link rel="prefetch" href="/WJ-blog/assets/js/8.c25125db.js"><link rel="prefetch" href="/WJ-blog/assets/js/9.c239490a.js">
    <link rel="stylesheet" href="/WJ-blog/assets/css/0.styles.ac442f4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/WJ-blog/" class="home-link router-link-active"><!----> <span class="site-name">WJ-blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/WJ-blog/front/introduction.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/WJ-blog/algorithm/study-leetcode.html" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/WJ-blog/life/introduction.html" class="nav-link">
  生活
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/WJ-blog/front/introduction.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/WJ-blog/algorithm/study-leetcode.html" class="nav-link">
  算法题库
</a></div><div class="nav-item"><a href="/WJ-blog/life/introduction.html" class="nav-link">
  生活
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/WJ-blog/front/introduction.html" class="sidebar-link">介绍</a></li><li><a href="/WJ-blog/front/study/single-spa-understand.html" class="sidebar-link">关于single-spa的理解和小实战</a></li><li><a href="/WJ-blog/front/study/typescript-about-interface-understand.html" class="sidebar-link">TYPESCRIPT 关于interface理解</a></li><li><a href="/WJ-blog/front/study/css3 transform, transform-origin usage.html" class="sidebar-link">css3 transform, transform-origin 用法</a></li><li><a href="/WJ-blog/front/study/virtualList-fixedItem.html" class="sidebar-link">虚拟列表(item固定高度实现+理解)</a></li><li><a href="/WJ-blog/front/study/virtualList-dynamatic.html" class="sidebar-link">虚拟列表(item高度不固定实现+理解)</a></li><li><a href="/WJ-blog/front/study/virtualList-intersectionObserver1.html" class="sidebar-link">虚拟列表(item 固定高度--采用intersectionObserver)(一)</a></li><li><a href="/WJ-blog/front/study/virtualList-intersectionObserver2.html" class="sidebar-link">虚拟列表(item 固定高度--采用intersectionObserver)(二)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>工作遇到的问题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/WJ-blog/front/work/realize-iframe-and-window.postMessage.html" aria-current="page" class="active sidebar-link">认识iframe和window.postMessage的使用</a></li><li><a href="/WJ-blog/front/work/vue-admin keep-alive-multiple-router-can't-cathe.html" class="sidebar-link">vue 使用keep-alive 三级以上的路由，无法缓存问题</a></li><li><a href="/WJ-blog/front/work/scrollIntoView VS scrollIntoViewIfNeeded.html" class="sidebar-link">scrollIntoView VS scrollIntoViewIfNeeded、爬坑</a></li><li><a href="/WJ-blog/front/work/circle-progress-by-css3.html" class="sidebar-link">静态环形进度条css3实现</a></li><li><a href="/WJ-blog/front/work/circle-progress-by-svg.html" class="sidebar-link">静态环形进度条svg实现</a></li><li><a href="/WJ-blog/front/work/element-ui-use-tricks.html" class="sidebar-link">element-ui 使用时的奇淫巧技</a></li><li><a href="/WJ-blog/front/work/git revert VS git reset.html" class="sidebar-link">git revert VS git reset</a></li><li><a href="/WJ-blog/front/work/git revert recover file.html" class="sidebar-link">git revert恢复撤销的记录</a></li><li><a href="/WJ-blog/front/work/git revert multiple commit.html" class="sidebar-link">git revert多条记录</a></li><li><a href="/WJ-blog/front/work/vue element fonts cannot find after building.html" class="sidebar-link">vue 2.x之打包之后，elements的fonts文件找不到，导致页面图标丢失问题解决</a></li><li><a href="/WJ-blog/front/work/divEditable-1-knowledge.html" class="sidebar-link">六期模块--计算公式功能点梳理(一)：知识点梳理</a></li><li><a href="/WJ-blog/front/work/divEditable-2-knowledge.html" class="sidebar-link">六期模块--计算公式功能点梳理(二)：梳理代码 + 解惑篇</a></li></ul></section></li><li><a href="/WJ-blog/algorithm/study-leetcode.html" class="sidebar-link">刷leetcode部分笔记总结</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>生活杂记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/WJ-blog/life/introduction.html" class="sidebar-link">介绍</a></li><li><a href="/WJ-blog/life/lifeDaily/2021-7-7-life.html" class="sidebar-link">2021年7月7日生活笔记</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><font color="blue" size="24">认识iframe和window.postMessage的使用</font></p> <h4 id="_1、起因"><a href="#_1、起因" class="header-anchor">#</a> 1、起因</h4> <p>是看到有赞技术博客里的这篇文章，<a href="%5Bhttps://tech.youzan.com/meiye-decorate/%5D(https://tech.youzan.com/meiye-decorate/)">有赞美业店铺装修前端解决方案</a>
里面讲解了他们是如何实现店铺装修前端的架构，其中的模块和设计思想很值得一读(✪ω✪)。其中的这个关于pc页面和h5页面的思想，用到了iframe和postMessage的思想，感觉也是非常巧妙，利用这些做到了页面代码的复用，减少了重复造轮子的问题。</p> <p>由于对于iframe接触的非常少，那还是先去了解一下原理和内容，再仔细看文章里的实现吧。</p> <p>mdn里关于window.postMessage链接：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener noreferrer">window.postMessage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>上述链接已经讲得很仔细了，不再做过多的重复。</p> <p><strong>值得注意的一点是：</strong></p> <p>otherWindow.postMessage(message, targetOrigin, [transfer])中，</p> <p><strong>第一个参数：message</strong></p> <p>在 Gecko 6.0 (Firefox 6.0 / Thunderbird 6.0 / SeaMonkey 2.3)之前， 参数 <code>message 必须是一个字符串。</code> 从 Gecko 6.0 (Firefox 6.0 / Thunderbird 6.0 / SeaMonkey 2.3)开始，参数 <code>message被</code>使用<a href="https://developer.mozilla.org/en-US/docs/DOM/The_structured_clone_algorithm" target="_blank" rel="noopener noreferrer">结构化克隆算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进行序列化。这意味着您可以将各种各样的数据对象安全地传递到目标窗口，而不必自己序列化它们。**</p> <p><em><strong>所以，一般来说不做兼容浏览器的处理时，我们现在可以传 各种各样的数据对象，而不是只能传递字符串</strong></em></p> <h4 id="_2、写demo"><a href="#_2、写demo" class="header-anchor">#</a> 2、写demo</h4> <ul><li>自己写个测试的Demo例子吧，如何在一个名叫A.html里面使用iframe，嵌入另一个html叫B。在A.html发送消息给B,B的页面接收到发送的消息,显示出来。同时B也可以使用 <strong>window.postMessage</strong>发送消息给A。这样就实现了不太页面消息的传递</li></ul> <p>这里的例子主要参考的是这篇文章：<a href="%5Bhttps://juejin.im/post/590c3983ac502e006531df11%5D(https://juejin.im/post/590c3983ac502e006531df11)">使用 postMessage 解决 iframe 跨域通信问题</a></p> <ul><li>首先来看A.html</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">border</span><span class="token punctuation">:</span> 5px solid red<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>this is A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./B.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myFrame<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>再来看B.html</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">border</span><span class="token punctuation">:</span> 5px solid yellow<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>this is B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>效果图如下：<img src="http://upload-images.jianshu.io/upload_images/1273659-283dac87c1b7f3d1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="效果图"></p> <ul><li>接下来再看如何让A发送消息给B,B接收到消息呢？</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myFrame'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'A页面给你发消息啦~~'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//以下是用来接收B页面发给A页面消息的逻辑</span>
 window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span>receiveMessage<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">function</span> <span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A页面收到来自B的消息了==&gt;'</span><span class="token punctuation">,</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>接下来再B如何接收到A页面所发消息，并向A再发送一个消息？</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code> window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span>receiveMessage<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">function</span> <span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B页面收到来自A的消息了==&gt;'</span><span class="token punctuation">,</span>event<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'B页面也发送个消息给A页面你吧~'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>页面上打印的结果如下：</li></ul> <p><img src="https://upload-images.jianshu.io/upload_images/1273659-cc60160d617f43a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="结果图"></p> <p>即这样我们就实现了不同源之间的交流。</p> <p>那会到最开始有赞店铺装修的前端处理，如何让pc设计更新后，预览的h5页面使用同一套代码（实现跨端复用）呢，就是用了iframe和window.postMessage去处理。详细代码可参考链接，为了更好的理解，</p> <p>画一个图了解一下：</p> <p><img src="https://upload-images.jianshu.io/upload_images/1273659-38bdfc278e77b9b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="类Messager的设计思路"></p> <p>那对应的h5如果做到复用一套代码呢？文章中是这么写的，</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>messager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Messager</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>parent<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">//mei.youzan.com</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">this</span><span class="token punctuation">.</span>messager<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'pageChangeFromReact'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>即打个比方，<strong>pc端做的事情：</strong></p> <p>pc端嵌入了iframe, 来源是h5的页面。pc每次绘制完毕或者点击完成或者保存时，都会</p> <ul><li>在消息存储动作对象上，先去绑定绘制、完成、保存这些事件类型</li> <li>绑定完成后，在合适的节点去触发 由pc -&gt; h5的一个事件消息发送，告诉h5：“h5渲染端 ,你好！我现在的事件类型是绘制更新完毕/点击完成/点击保存，要渲染的值是blabla...，我的地址是xxx”</li> <li>由于页面关闭或者一些其他原因，要去销毁这个事件监听器, 防止内存泄露（低版本的ie如果不手动销毁，可能会有问题）</li></ul> <p>敲黑板：</p> <p><strong>这里关于window.addEventListener的理解和解释，这篇文章写得很好： <a href="https://blog.csdn.net/qq_29606781/article/details/67650869" target="_blank" rel="noopener noreferrer">js添加事件和移除事件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p><strong>对于h5端，它要做的事情：</strong></p> <ul><li><p>创建一个自己的messager实例，事件数据来源来自pc端。即h5现在拥有，Messager类里图中所画出的所有属性、值和方法</p></li> <li><p>h5 在消息事件监听处理后，拿到从pc页面传来的消息，即h5: &quot;啊哈哈,我收到消息了，现在的消息是blabla。。。&quot;,然后对消息进行解析渲染。</p></li></ul> <p>这样就可以利用iframe和postMessage，实现共用一份代码，实现更新。</p> <section style="border-top:2px solid #eaecef;padding-top:1rem;margin-top:2rem;"><div><span data-flag-title="Your Article Title" class="leancloud-visitors"><em class="post-meta-item-text">阅读量： </em> <i class="leancloud-visitors-count"></i></span></div> <h3><a href="javascript:;"></a>
    评 论：
  </h3> <div id="vcomments"></div></section></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">4/11/2022, 1:51:28 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/WJ-blog/front/study/virtualList-intersectionObserver2.html" class="prev">
        虚拟列表(item 固定高度--采用intersectionObserver)(二)
      </a></span> <span class="next"><a href="/WJ-blog/front/work/vue-admin keep-alive-multiple-router-can't-cathe.html">
        vue 使用keep-alive 三级以上的路由，无法缓存问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/WJ-blog/assets/js/app.9890bca3.js" defer></script><script src="/WJ-blog/assets/js/2.38039cab.js" defer></script><script src="/WJ-blog/assets/js/32.7c28f772.js" defer></script><script src="/WJ-blog/assets/js/19.c27f844c.js" defer></script>
  </body>
</html>
